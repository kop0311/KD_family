<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KD之家 - 现代家务积分系统</title>
    <link rel="icon" type="image/svg+xml" href="./assets/logo.svg">
    <meta http-equiv="refresh" content="0; url=./index-modern.html">
    <script>
        // Immediate redirect for better compatibility
        window.location.replace('./index-modern.html');
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .redirect-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: 2rem;
        }
        .logo {
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
        }
        .title {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 1rem;
        }
        .subtitle {
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .manual-link {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        .manual-link:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="redirect-container">
        <img src="./assets/logo.svg" alt="KD之家" class="logo">
        <h1 class="title">KD之家</h1>
        <p class="subtitle">正在跳转到现代化界面...</p>
        <div class="loading"></div>
        <p style="margin-top: 2rem; color: #666; font-size: 0.875rem;">
            如果页面没有自动跳转，请点击下方链接：
        </p>
        <a href="./index-modern.html" class="manual-link">进入KD之家</a>
    </div>
</body>
</html>

        <!-- 认证区域 -->
        <div id="auth" class="section active">
            <div class="grid">
                <div>
                    <h3>用户登录</h3>
                    <form id="loginForm">
                        <div class="form-group">
                            <label>用户名:</label>
                            <input type="text" id="loginUsername" required>
                        </div>
                        <div class="form-group">
                            <label>密码:</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn">登录</button>
                    </form>
                </div>
                <div>
                    <h3>用户注册</h3>
                    <form id="registerForm">
                        <div class="form-group">
                            <label>用户名:</label>
                            <input type="text" id="regUsername" required>
                        </div>
                        <div class="form-group">
                            <label>邮箱:</label>
                            <input type="email" id="regEmail" required>
                        </div>
                        <div class="form-group">
                            <label>密码:</label>
                            <input type="password" id="regPassword" required>
                        </div>
                        <div class="form-group">
                            <label>全名:</label>
                            <input type="text" id="regFullName" required>
                        </div>
                        <div class="form-group">
                            <label>角色:</label>
                            <select id="regRole">
                                <option value="member">家庭成员</option>
                                <option value="parent">家长</option>
                                <option value="advisor">顾问</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">注册</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- 仪表板 -->
        <div id="dashboard" class="section">
            <h3>📊 个人仪表板</h3>
            <div id="dashboardContent">
                <div class="grid">
                    <div class="task-item">
                        <h4>我的统计</h4>
                        <p>总积分: <span id="dashTotalPoints">0</span></p>
                        <p>本周积分: <span id="dashWeekPoints">0</span></p>
                        <p>完成任务: <span id="dashCompletedTasks">0</span></p>
                    </div>
                    <div class="task-item">
                        <h4>我的任务</h4>
                        <div id="myTasks"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 任务管理 -->
        <div id="tasks" class="section">
            <h3>📋 任务管理</h3>
            <div id="taskManagement">
                <button id="refreshTasksBtn" class="btn">刷新任务</button>
                <button id="createTaskBtn" class="btn" style="display: none;">创建任务</button>
                
                <div id="createTaskForm" class="task-item" style="display: none; margin-top: 20px;">
                    <h4>创建新任务</h4>
                    <form id="createTaskFormElement">
                        <div class="form-group">
                            <label>任务标题:</label>
                            <input type="text" id="taskTitle" required>
                        </div>
                        <div class="form-group">
                            <label>任务描述:</label>
                            <textarea id="taskDescription"></textarea>
                        </div>
                        <div class="form-group">
                            <label>任务类型:</label>
                            <select id="taskType" required>
                                <option value="PM">项目管理</option>
                                <option value="FTL">固定任务</option>
                                <option value="PA">项目协助</option>
                                <option value="UBI">每日必做</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>积分:</label>
                            <input type="number" id="taskPoints" min="1" max="100">
                        </div>
                        <div class="form-group">
                            <label>截止日期:</label>
                            <input type="date" id="taskDueDate">
                        </div>
                        <button type="submit" class="btn">创建任务</button>
                        <button type="button" id="cancelTaskBtn" class="btn btn-danger">取消</button>
                    </form>
                </div>
                
                <div id="tasksList"></div>
            </div>
        </div>

        <!-- 积分中心 -->
        <div id="points" class="section">
            <h3>💰 积分中心</h3>
            <div class="grid">
                <div>
                    <h4>排行榜</h4>
                    <div id="leaderboard" class="leaderboard"></div>
                </div>
                <div>
                    <h4>积分历史</h4>
                    <div id="pointsHistory"></div>
                </div>
            </div>
        </div>

        <!-- 管理中心 -->
        <div id="admin" class="section">
            <h3>⚙️ 管理中心</h3>
            <div id="adminContent">
                <div class="grid">
                    <div class="task-item">
                        <h4>系统统计</h4>
                        <div id="adminStats"></div>
                    </div>
                    <div class="task-item">
                        <h4>用户管理</h4>
                        <div id="usersList"></div>
                    </div>
                    <div class="task-item">
                        <h4>添加用户</h4>
                        <form id="addUserForm">
                            <div class="form-group">
                                <label>用户名:</label>
                                <input type="text" id="addUsername" required>
                            </div>
                            <div class="form-group">
                                <label>邮箱:</label>
                                <input type="email" id="addEmail">
                            </div>
                            <div class="form-group">
                                <label>密码:</label>
                                <input type="password" id="addPassword" required>
                            </div>
                            <div class="form-group">
                                <label>全名:</label>
                                <input type="text" id="addFullName" required>
                            </div>
                            <div class="form-group">
                                <label>角色:</label>
                                <select id="addRole">
                                    <option value="member">家庭成员</option>
                                    <option value="parent">家长</option>
                                    <option value="advisor">顾问</option>
                                </select>
                            </div>
                            <button type="submit" class="btn">添加用户</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="messages"></div>
    </div>

    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>选择头像</h3>
            
            <!-- 在线头像选择区域 -->
            <div class="avatar-section">
                <div class="avatar-controls">
                    <button id="refreshAvatarsBtn" class="btn" style="margin-bottom: 10px;">换一批</button>
                    <div id="avatarLoading" class="hidden" style="text-align: center; margin: 10px 0;">
                        <span>正在加载头像...</span>
                    </div>
                </div>
                <div class="avatar-gallery" id="avatarGallery">
                    <!-- Avatar images will be loaded here -->
                </div>
                <div class="avatar-actions" id="avatarActions" style="display: none; text-align: center; margin-top: 15px;">
                    <button id="confirmAvatarBtn" class="btn">确认选择</button>
                    <button id="cancelAvatarBtn" class="btn btn-danger">取消</button>
                </div>
            </div>
            
            <hr>
            
            <!-- 本地上传区域 -->
            <div class="upload-section">
                <h4>或者上传你自己的照片</h4>
                <div class="form-group">
                    <input type="file" id="modalAvatarInput" name="avatar" accept="image/*" style="margin-bottom: 10px;">
                    <button id="uploadAvatarBtn" class="btn" disabled>上传头像</button>
                </div>
                
                <!-- 图片预览和裁剪区域 -->
                <div id="imagePreviewSection" class="hidden" style="margin-top: 15px;">
                    <h5>预览和调整</h5>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <!-- 头像预览容器 -->
                        <div style="position: relative; display: inline-block; width: 200px; height: 200px; border: 2px dashed #ddd; border-radius: 50%; overflow: hidden; background: #f8f9fa;">
                            <img id="imagePreview" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
                        </div>
                    </div>
                    
                    <!-- 控制按钮组 -->
                    <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="text-align: center;">
                            <p style="margin-bottom: 5px;">大小调整:</p>
                            <input type="range" id="imageSizeSlider" min="80" max="150" value="100" style="width: 120px;">
                            <br><span id="sizeValue">100%</span>
                        </div>
                        <div style="text-align: center;">
                            <p style="margin-bottom: 5px;">旋转调整:</p>
                            <button id="rotateImageBtn" class="btn" style="padding: 8px 12px; font-size: 14px;">旋转 90°</button>
                        </div>
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div style="text-align: center;">
                        <button id="confirmUploadBtn" class="btn">确认上传</button>
                        <button id="cancelUploadBtn" class="btn btn-danger">取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>