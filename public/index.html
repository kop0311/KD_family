<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDä¹‹å®¶ - ç°ä»£å®¶åŠ¡ç§¯åˆ†ç³»ç»Ÿ</title>
    <link rel="icon" type="image/svg+xml" href="./assets/logo.svg">
    <meta http-equiv="refresh" content="0; url=./index-modern.html">
    <script>
        // Immediate redirect for better compatibility
        window.location.replace('./index-modern.html');
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .redirect-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: 2rem;
        }
        .logo {
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
        }
        .title {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 1rem;
        }
        .subtitle {
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .manual-link {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        .manual-link:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="redirect-container">
        <img src="./assets/logo.svg" alt="KDä¹‹å®¶" class="logo">
        <h1 class="title">KDä¹‹å®¶</h1>
        <p class="subtitle">æ­£åœ¨è·³è½¬åˆ°ç°ä»£åŒ–ç•Œé¢...</p>
        <div class="loading"></div>
        <p style="margin-top: 2rem; color: #666; font-size: 0.875rem;">
            å¦‚æœé¡µé¢æ²¡æœ‰è‡ªåŠ¨è·³è½¬ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹é“¾æ¥ï¼š
        </p>
        <a href="./index-modern.html" class="manual-link">è¿›å…¥KDä¹‹å®¶</a>
    </div>
</body>
</html>

        <!-- è®¤è¯åŒºåŸŸ -->
        <div id="auth" class="section active">
            <div class="grid">
                <div>
                    <h3>ç”¨æˆ·ç™»å½•</h3>
                    <form id="loginForm">
                        <div class="form-group">
                            <label>ç”¨æˆ·å:</label>
                            <input type="text" id="loginUsername" required>
                        </div>
                        <div class="form-group">
                            <label>å¯†ç :</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn">ç™»å½•</button>
                    </form>
                </div>
                <div>
                    <h3>ç”¨æˆ·æ³¨å†Œ</h3>
                    <form id="registerForm">
                        <div class="form-group">
                            <label>ç”¨æˆ·å:</label>
                            <input type="text" id="regUsername" required>
                        </div>
                        <div class="form-group">
                            <label>é‚®ç®±:</label>
                            <input type="email" id="regEmail" required>
                        </div>
                        <div class="form-group">
                            <label>å¯†ç :</label>
                            <input type="password" id="regPassword" required>
                        </div>
                        <div class="form-group">
                            <label>å…¨å:</label>
                            <input type="text" id="regFullName" required>
                        </div>
                        <div class="form-group">
                            <label>è§’è‰²:</label>
                            <select id="regRole">
                                <option value="member">å®¶åº­æˆå‘˜</option>
                                <option value="parent">å®¶é•¿</option>
                                <option value="advisor">é¡¾é—®</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">æ³¨å†Œ</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ä»ªè¡¨æ¿ -->
        <div id="dashboard" class="section">
            <h3>ğŸ“Š ä¸ªäººä»ªè¡¨æ¿</h3>
            <div id="dashboardContent">
                <div class="grid">
                    <div class="task-item">
                        <h4>æˆ‘çš„ç»Ÿè®¡</h4>
                        <p>æ€»ç§¯åˆ†: <span id="dashTotalPoints">0</span></p>
                        <p>æœ¬å‘¨ç§¯åˆ†: <span id="dashWeekPoints">0</span></p>
                        <p>å®Œæˆä»»åŠ¡: <span id="dashCompletedTasks">0</span></p>
                    </div>
                    <div class="task-item">
                        <h4>æˆ‘çš„ä»»åŠ¡</h4>
                        <div id="myTasks"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡ç®¡ç† -->
        <div id="tasks" class="section">
            <h3>ğŸ“‹ ä»»åŠ¡ç®¡ç†</h3>
            <div id="taskManagement">
                <button id="refreshTasksBtn" class="btn">åˆ·æ–°ä»»åŠ¡</button>
                <button id="createTaskBtn" class="btn" style="display: none;">åˆ›å»ºä»»åŠ¡</button>
                
                <div id="createTaskForm" class="task-item" style="display: none; margin-top: 20px;">
                    <h4>åˆ›å»ºæ–°ä»»åŠ¡</h4>
                    <form id="createTaskFormElement">
                        <div class="form-group">
                            <label>ä»»åŠ¡æ ‡é¢˜:</label>
                            <input type="text" id="taskTitle" required>
                        </div>
                        <div class="form-group">
                            <label>ä»»åŠ¡æè¿°:</label>
                            <textarea id="taskDescription"></textarea>
                        </div>
                        <div class="form-group">
                            <label>ä»»åŠ¡ç±»å‹:</label>
                            <select id="taskType" required>
                                <option value="PM">é¡¹ç›®ç®¡ç†</option>
                                <option value="FTL">å›ºå®šä»»åŠ¡</option>
                                <option value="PA">é¡¹ç›®ååŠ©</option>
                                <option value="UBI">æ¯æ—¥å¿…åš</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç§¯åˆ†:</label>
                            <input type="number" id="taskPoints" min="1" max="100">
                        </div>
                        <div class="form-group">
                            <label>æˆªæ­¢æ—¥æœŸ:</label>
                            <input type="date" id="taskDueDate">
                        </div>
                        <button type="submit" class="btn">åˆ›å»ºä»»åŠ¡</button>
                        <button type="button" id="cancelTaskBtn" class="btn btn-danger">å–æ¶ˆ</button>
                    </form>
                </div>
                
                <div id="tasksList"></div>
            </div>
        </div>

        <!-- ç§¯åˆ†ä¸­å¿ƒ -->
        <div id="points" class="section">
            <h3>ğŸ’° ç§¯åˆ†ä¸­å¿ƒ</h3>
            <div class="grid">
                <div>
                    <h4>æ’è¡Œæ¦œ</h4>
                    <div id="leaderboard" class="leaderboard"></div>
                </div>
                <div>
                    <h4>ç§¯åˆ†å†å²</h4>
                    <div id="pointsHistory"></div>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†ä¸­å¿ƒ -->
        <div id="admin" class="section">
            <h3>âš™ï¸ ç®¡ç†ä¸­å¿ƒ</h3>
            <div id="adminContent">
                <div class="grid">
                    <div class="task-item">
                        <h4>ç³»ç»Ÿç»Ÿè®¡</h4>
                        <div id="adminStats"></div>
                    </div>
                    <div class="task-item">
                        <h4>ç”¨æˆ·ç®¡ç†</h4>
                        <div id="usersList"></div>
                    </div>
                    <div class="task-item">
                        <h4>æ·»åŠ ç”¨æˆ·</h4>
                        <form id="addUserForm">
                            <div class="form-group">
                                <label>ç”¨æˆ·å:</label>
                                <input type="text" id="addUsername" required>
                            </div>
                            <div class="form-group">
                                <label>é‚®ç®±:</label>
                                <input type="email" id="addEmail">
                            </div>
                            <div class="form-group">
                                <label>å¯†ç :</label>
                                <input type="password" id="addPassword" required>
                            </div>
                            <div class="form-group">
                                <label>å…¨å:</label>
                                <input type="text" id="addFullName" required>
                            </div>
                            <div class="form-group">
                                <label>è§’è‰²:</label>
                                <select id="addRole">
                                    <option value="member">å®¶åº­æˆå‘˜</option>
                                    <option value="parent">å®¶é•¿</option>
                                    <option value="advisor">é¡¾é—®</option>
                                </select>
                            </div>
                            <button type="submit" class="btn">æ·»åŠ ç”¨æˆ·</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="messages"></div>
    </div>

    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>é€‰æ‹©å¤´åƒ</h3>
            
            <!-- åœ¨çº¿å¤´åƒé€‰æ‹©åŒºåŸŸ -->
            <div class="avatar-section">
                <div class="avatar-controls">
                    <button id="refreshAvatarsBtn" class="btn" style="margin-bottom: 10px;">æ¢ä¸€æ‰¹</button>
                    <div id="avatarLoading" class="hidden" style="text-align: center; margin: 10px 0;">
                        <span>æ­£åœ¨åŠ è½½å¤´åƒ...</span>
                    </div>
                </div>
                <div class="avatar-gallery" id="avatarGallery">
                    <!-- Avatar images will be loaded here -->
                </div>
                <div class="avatar-actions" id="avatarActions" style="display: none; text-align: center; margin-top: 15px;">
                    <button id="confirmAvatarBtn" class="btn">ç¡®è®¤é€‰æ‹©</button>
                    <button id="cancelAvatarBtn" class="btn btn-danger">å–æ¶ˆ</button>
                </div>
            </div>
            
            <hr>
            
            <!-- æœ¬åœ°ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-section">
                <h4>æˆ–è€…ä¸Šä¼ ä½ è‡ªå·±çš„ç…§ç‰‡</h4>
                <div class="form-group">
                    <input type="file" id="modalAvatarInput" name="avatar" accept="image/*" style="margin-bottom: 10px;">
                    <button id="uploadAvatarBtn" class="btn" disabled>ä¸Šä¼ å¤´åƒ</button>
                </div>
                
                <!-- å›¾ç‰‡é¢„è§ˆå’Œè£å‰ªåŒºåŸŸ -->
                <div id="imagePreviewSection" class="hidden" style="margin-top: 15px;">
                    <h5>é¢„è§ˆå’Œè°ƒæ•´</h5>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <!-- å¤´åƒé¢„è§ˆå®¹å™¨ -->
                        <div style="position: relative; display: inline-block; width: 200px; height: 200px; border: 2px dashed #ddd; border-radius: 50%; overflow: hidden; background: #f8f9fa;">
                            <img id="imagePreview" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
                        </div>
                    </div>
                    
                    <!-- æ§åˆ¶æŒ‰é’®ç»„ -->
                    <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="text-align: center;">
                            <p style="margin-bottom: 5px;">å¤§å°è°ƒæ•´:</p>
                            <input type="range" id="imageSizeSlider" min="80" max="150" value="100" style="width: 120px;">
                            <br><span id="sizeValue">100%</span>
                        </div>
                        <div style="text-align: center;">
                            <p style="margin-bottom: 5px;">æ—‹è½¬è°ƒæ•´:</p>
                            <button id="rotateImageBtn" class="btn" style="padding: 8px 12px; font-size: 14px;">æ—‹è½¬ 90Â°</button>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div style="text-align: center;">
                        <button id="confirmUploadBtn" class="btn">ç¡®è®¤ä¸Šä¼ </button>
                        <button id="cancelUploadBtn" class="btn btn-danger">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>