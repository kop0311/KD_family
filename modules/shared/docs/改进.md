    name="description"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>任务描述</FormLabel>
                    <FormControl>
                      <Textarea 
                        placeholder="详细描述任务内容"
                        className="min-h-[100px]"
                        {...field}
                      />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <div className="grid grid-cols-2 gap-4">
                <FormField
                  control={form.control}
                  name="points"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>积分奖励</FormLabel>
                      <FormControl>
                        <Input
                          type="number"
                          min="1"
                          {...field}
                          onChange={(e) => field.onChange(Number(e.target.value))}
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                <FormField
                  control={form.control}
                  name="dueDate"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>截止日期</FormLabel>
                      <FormControl>
                        <Input
                          type="datetime-local"
                          {...field}
                          value={field.value ? format(field.value, "yyyy-MM-dd'T'HH:mm") : ''}
                          onChange={(e) => field.onChange(new Date(e.target.value))}
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />
              </div>

              <div className="flex justify-between">
                <Button
                  type="button"
                  variant="ghost"
                  onClick={() => navigate('/tasks')}
                >
                  取消
                </Button>
                <Button
                  type="submit"
                  disabled={createTaskMutation.isLoading}
                >
                  {createTaskMutation.isLoading ? (
                    <Loader2 className="w-4 h-4 animate-spin mr-2" />
                  ) : null}
                  创建任务
                </Button>
              </div>
            </div>
          </form>
        </GlassContainer>
      </div>
    );
  };

  2.4 用户管理功能 (1-2天)

  Day 8-9: 个人资料和排行榜
  // src/features/profile/UserProfile.tsx
  export const UserProfile: React.FC = () => {
    const { user, updateUser } = useAuth();
    const [isEditing, setIsEditing] = useState(false);
    const [avatar, setAvatar] = useState<File | null>(null);

    const updateProfileMutation = useMutation(
      (profileData: UpdateProfileData) => api.put(`/api/users/${user.id}`, profileData),
      {
        onSuccess: (updatedUser) => {
          updateUser(updatedUser);
          setIsEditing(false);
          showNotification('个人资料更新成功', 'success');
        }
      }
    );

    const uploadAvatarMutation = useMutation(
      (file: File) => {
        const formData = new FormData();
        formData.append('avatar', file);
        return api.post(`/api/users/${user.id}/avatar`, formData);
      },
      {
        onSuccess: (response) => {
          updateUser({ ...user, avatar: response.data.avatarUrl });
          showNotification('头像上传成功', 'success');
        }
      }
    );

    return (
      <div className="max-w-4xl mx-auto space-y-6">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <GlassContainer className="p-6 lg:col-span-1">
            <div className="text-center">
              <div className="relative inline-block">
                <Avatar className="w-24 h-24 mx-auto">
                  <AvatarImage src={user.avatar} />
                  <AvatarFallback>{user.name[0]}</AvatarFallback>
                </Avatar>
                <Button
                  size="sm"
                  variant="ghost"
                  className="absolute bottom-0 right-0"
                  onClick={() => document.getElementById('avatar-upload')?.click()}
                >
                  <Camera className="w-4 h-4" />
                </Button>
                <input
                  id="avatar-upload"
                  type="file"
                  accept="image/*"
                  className="hidden"
                  onChange={(e) => {
                    const file = e.target.files?.[0];
                    if (file) uploadAvatarMutation.mutate(file);
                  }}
                />
              </div>
              <h2 className="text-xl font-bold text-white mt-4">{user.name}</h2>
              <p className="text-white/70">{user.email}</p>
            </div>
          </GlassContainer>

          <GlassContainer className="p-6 lg:col-span-2">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-semibold text-white">个人信息</h3>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setIsEditing(!isEditing)}
              >
                <Edit className="w-4 h-4 mr-2" />
                {isEditing ? '取消' : '编辑'}
              </Button>
            </div>

            {isEditing ? (
              <ProfileEditForm
                user={user}
                onSubmit={(data) => updateProfileMutation.mutate(data)}
                isLoading={updateProfileMutation.isLoading}
              />
            ) : (
              <ProfileDisplay user={user} />
            )}
          </GlassContainer>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          <StatCard title="总积分" value={user.totalPoints} icon={<Trophy />} />
          <StatCard title="完成任务" value={user.completedTasks} icon={<CheckCircle />} />
          <StatCard title="当前等级" value={user.level} icon={<Star />} />
        </div>
      </div>
    );
  };

  // src/features/leaderboard/Leaderboard.tsx
  export const Leaderboard: React.FC = () => {
    const { data: rankings, isLoading } = useQuery(
      ['leaderboard'],
      () => api.get('/api/leaderboard')
    );

    return (
      <div className="space-y-6">
        <h1 className="text-2xl font-bold text-white">家庭排行榜</h1>

        <div className="grid gap-4">
          {rankings?.map((user, index) => (
            <GlassContainer key={user.id} className="p-4">
              <div className="flex items-center space-x-4">
                <div className={`w-8 h-8 rounded-full flex items-center justify-center ${
                  index === 0 ? 'bg-yellow-500' :
                  index === 1 ? 'bg-gray-400' :
                  index === 2 ? 'bg-amber-600' : 'bg-white/20'
                }`}>
                  <span className="font-bold text-white">{index + 1}</span>
                </div>

                <Avatar>
                  <AvatarImage src={user.avatar} />
                  <AvatarFallback>{user.name[0]}</AvatarFallback>
                </Avatar>

                <div className="flex-1">
                  <h3 className="font-semibold text-white">{user.name}</h3>
                  <p className="text-white/70 text-sm">等级 {user.level}</p>
                </div>

                <div className="text-right">
                  <p className="text-2xl font-bold text-white">{user.totalPoints}</p>
                  <p className="text-white/70 text-sm">积分</p>
                </div>
              </div>
            </GlassContainer>
          ))}
        </div>
      </div>
    );
  };

  ---
  📅 Phase 3: Magic UI 集成 (3-4天)

  3.1 Magic UI 设置和基础组件替换 (2天)

  技术目标

  - 安装并配置Magic UI组件库
  - 替换基础UI组件保持设计一致性
  - 确保glass-morphism效果兼容

  Day 10-11: Magic UI 集成
  # 安装Magic UI
  npm install @magic-ui/react framer-motion

  # 配置Tailwind CSS支持Magic UI

  // tailwind.config.js 更新
  module.exports = {
    content: [
      './src/**/*.{js,ts,jsx,tsx}',
      './node_modules/@magic-ui/react/**/*.{js,ts,jsx,tsx}'
    ],
    theme: {
      extend: {
        // Magic UI 主题配置
        keyframes: {
          'magic-fade-in': {
            '0%': { opacity: '0', transform: 'translateY(10px)' },
            '100%': { opacity: '1', transform: 'translateY(0)' }
          }
        },
        animation: {
          'magic-fade-in': 'magic-fade-in 0.3s ease-out'
        }
      }
    }
  };

  // src/components/ui/enhanced/MagicButton.tsx
  import { Button as MagicButton } from '@magic-ui/react';
  import { cn } from '@/lib/utils';

  export const Button: React.FC<ButtonProps> = ({ 
    className, 
    variant = 'default',
    ...props 
  }) => {
    const glassStyles = {
      default: 'bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20',
      primary: 'bg-blue-500/20 backdrop-blur-md border border-blue-300/30 hover:bg-blue-500/30',
      secondary: 'bg-purple-500/20 backdrop-blur-md border border-purple-300/30 hover:bg-purple-500/30'
    };

    return (
      <MagicButton
        className={cn(
          'text-white shadow-glass transition-all duration-300',
          glassStyles[variant],
          className
        )}
        {...props}
      />
    );
  };

  // src/components/ui/enhanced/MagicCard.tsx
  import { Card as MagicCard } from '@magic-ui/react';

  export const GlassContainer: React.FC<GlassContainerProps> = ({ 
    children, 
    className,
    ...props 
  }) => {
    return (
      <MagicCard
        className={cn(
          'bg-white/10 backdrop-blur-md border border-white/20 shadow-glass',
          'rounded-xl p-4 transition-all duration-300 hover:bg-white/15',
          className
        )}
        {...props}
      >
        {children}
      </MagicCard>
    );
  };

  3.2 动画和交互增强 (1-2天)

  Day 12-13: 高级动画和微交互
  // src/components/ui/enhanced/AnimatedComponents.tsx
  import { motion } from 'framer-motion';
  import { Sparkles, ShimmerButton } from '@magic-ui/react';

  export const AnimatedTaskCard: React.FC<TaskCardProps> = ({ task, ...props }) => {
    return (
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        exit={{ opacity: 0, y: -20 }}
        whileHover={{ scale: 1.02 }}
        transition={{ duration: 0.2 }}
      >
        <GlassContainer className="relative overflow-hidden">
          <Sparkles className="absolute inset-0 opacity-30" />
          <TaskCard task={task} {...props} />
        </GlassContainer>
      </motion.div>
    );
  };

  export const CompletionButton: React.FC<{ onComplete: () => void }> = ({ onComplete }) => {
    return (
      <ShimmerButton
        onClick={onComplete}
        className="bg-green-500/20 border-green-300/30"
        shimmerColor="rgba(34, 197, 94, 0.3)"
      >
        <CheckCircle className="w-4 h-4 mr-2" />
        完成任务
      </ShimmerButton>
    );
  };

  // src/components/ui/enhanced/StatsDisplay.tsx
  import { NumberTicker, GradientText } from '@magic-ui/react';

  export const AnimatedStatCard: React.FC<StatCardProps> = ({ 
    title, 
    value, 
    icon, 
    trend 
  }) => {
    return (
      <motion.div
        whileHover={{ y: -5 }}
        transition={{ duration: 0.2 }}
      >
        <GlassContainer className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-white/70 text-sm">{title}</p>
              <GradientText
                className="text-3xl font-bold"
                colors={['#3B82F6', '#8B5CF6', '#06B6D4']}
              >
                <NumberTicker value={value} />
              </GradientText>
              <p className="text-green-400 text-sm">{trend}</p>
            </div>
            <motion.div
              animate={{ rotate: [0, 5, -5, 0] }}
              transition={{ duration: 2, repeat: Infinity }}
              className="text-white/50"
            >
              {icon}
            </motion.div>
          </div>
        </GlassContainer>
      </motion.div>
    );
  };

  ---
  📅 Phase 4: PWA 功能实现 (5-6天)

  4.1 Service Worker 和离线策略 (2-3天)

  技术目标

  - 实现智能缓存策略
  - 离线数据同步
  - 后台更新机制

  Day 14-15: Service Worker 基础设施
  // vite.config.ts PWA 配置
  import { VitePWA } from 'vite-plugin-pwa';

  export default defineConfig({
    plugins: [
      react(),
      VitePWA({
        registerType: 'autoUpdate',
        workbox: {
          globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}'],
          runtimeCaching: [
            {
              urlPattern: /^https:\/\/api\./,
              handler: 'NetworkFirst',
              options: {
                cacheName: 'api-cache',
                expiration: {
                  maxEntries: 100,
                  maxAgeSeconds: 24 * 60 * 60 // 24小时
                },
                networkTimeoutSeconds: 10
              }
            },
            {
              urlPattern: /^https:\/\/.*\.(?:png|jpg|jpeg|svg|gif)$/,
              handler: 'CacheFirst',
              options: {
                cacheName: 'images-cache',
                expiration: {
                  maxEntries: 50,
                  maxAgeSeconds: 30 * 24 * 60 * 60 // 30天
                }
              }
            }
          ]
        },
        manifest: {
          name: 'KD Family 家庭任务管理',
          short_name: 'KD Family',
          description: '现代化的家庭任务管理和积分系统',
          theme_color: '#3B82F6',
          background_color: '#1E293B',
          display: 'standalone',
          orientation: 'portrait',
          scope: '/',
          start_url: '/',
          icons: [
            {
              src: '/icons/icon-72x72.png',
              sizes: '72x72',
              type: 'image/png',
              purpose: 'any maskable'
            },
            {
              src: '/icons/icon-192x192.png',
              sizes: '192x192',
              type: 'image/png'
            },
            {
              src: '/icons/icon-512x512.png',
              sizes: '512x512',
              type: 'image/png'
            }
          ]
        }
      })
    ]
  });

  // src/hooks/usePWA.ts
  export const usePWA = () => {
    const [isOnline, setIsOnline] = useState(navigator.onLine);
    const [updateAvailable, setUpdateAvailable] = useState(false);
    const [deferredPrompt, setDeferredPrompt] = useState<any>(null);

    useEffect(() => {
      const handleOnline = () => setIsOnline(true);
      const handleOffline = () => setIsOnline(false);

      window.addEventListener('online', handleOnline);
      window.addEventListener('offline', handleOffline);

      // PWA安装提示
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        setDeferredPrompt(e);
      });

      return () => {
        window.removeEventListener('online', handleOnline);
        window.removeEventListener('offline', handleOffline);
      };
    }, []);

    const installPWA = async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          setDeferredPrompt(null);
        }
      }
    };

    return {
      isOnline,
      updateAvailable,
      canInstall: !!deferredPrompt,
      installPWA
    };
  };

  Day 16: 离线数据管理
  // src/services/offlineManager.ts
  class OfflineManager {
    private pendingActions: OfflineAction[] = [];
    private storeName = 'offline-actions';

    async addAction(action: OfflineAction) {
      this.pendingActions.push(action);
      await this.persistActions();
    }

    async syncWhenOnline() {
      if (!navigator.onLine) return;

      const actions = await this.getStoredActions();
      for (const action of actions) {
        try {
          await this.executeAction(action);
          this.removeAction(action.id);
        } catch (error) {
          console.error('离线同步失败:', error);
        }
      }
    }

    private async executeAction(action: OfflineAction) {
      switch (action.type) {
        case 'CREATE_TASK':
          return api.post('/api/tasks', action.data);
        case 'UPDATE_TASK':
          return api.put(`/api/tasks/${action.data.id}`, action.data);
        case 'COMPLETE_TASK':
          return api.patch(`/api/tasks/${action.data.id}/complete`);
        default:
          throw new Error(`未知的离线操作: ${action.type}`);
      }
    }

    private async persistActions() {
      localStorage.setItem(this.storeName, JSON.stringify(this.pendingActions));
    }

    private async getStoredActions(): Promise<OfflineAction[]> {
      const stored = localStorage.getItem(this.storeName);
      return stored ? JSON.parse(stored) : [];
    }
  }

  export const offlineManager = new OfflineManager();

  // src/components/common/OfflineIndicator.tsx
  export const OfflineIndicator: React.FC = () => {
    const { isOnline } = usePWA();

    if (isOnline) return null;

    return (
      <div className="fixed top-4 right-4 z-50">
        <GlassContainer className="p-3 bg-orange-500/20 border-orange-300/30">
          <div className="flex items-center space-x-2">
            <WifiOff className="w-4 h-4 text-orange-300" />
            <span className="text-white text-sm">离线模式</span>
          </div>
        </GlassContainer>
      </div>
    );
  };

  4.2 推送通知和安装提示 (2天)

  Day 17-18: 推送通知系统
  // src/services/notificationManager.ts
  class NotificationManager {
    async requestPermission(): Promise<boolean> {
      if ('Notification' in window) {
        const permission = await Notification.requestPermission();
        return permission === 'granted';
      }
      return false;
    }

    async sendNotification(title: string, options: NotificationOptions = {}) {
      if (await this.requestPermission()) {
        const registration = await navigator.serviceWorker.ready;
        await registration.showNotification(title, {
          badge: '/icons/badge-72x72.png',
          icon: '/icons/icon-192x192.png',
          vibrate: [200, 100, 200],
          ...options
        });
      }
    }

    async scheduleTaskReminder(task: Task) {
      const reminderTime = new Date(task.dueDate).getTime() - Date.now() - (2 * 60 * 60 * 1000); // 2小时前提醒

      if (reminderTime > 0) {
        setTimeout(() => {
          this.sendNotification('任务提醒', {
            body: `任务 "${task.title}" 将在2小时后到期`,
            tag: `task-reminder-${task.id}`,
            data: { taskId: task.id }
          });
        }, reminderTime);
      }
    }
  }

  export const notificationManager = new NotificationManager();

  // src/components/common/InstallPrompt.tsx
  export const InstallPrompt: React.FC = () => {
    const { canInstall, installPWA } = usePWA();
    const [showPrompt, setShowPrompt] = useState(false);

    useEffect(() => {
      if (canInstall) {
        // 延迟显示安装提示
        setTimeout(() => setShowPrompt(true), 10000);
      }
    }, [canInstall]);

    if (!showPrompt) return null;

    return (
      <AnimatePresence>
        <motion.div
          initial={{ opacity: 0, y: 50 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: 50 }}
          className="fixed bottom-4 left-4 right-4 z-50"
        >
          <GlassContainer className="p-4">
            <div className="flex items-center justify-between">
              <div className="flex-1">
                <h3 className="font-semibold text-white">安装应用</h3>
                <p className="text-white/70 text-sm">
                  将KD Family添加到主屏幕，获得更好的使用体验
                </p>
              </div>
              <div className="flex space-x-2">
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => setShowPrompt(false)}
                >
                  稍后
                </Button>
                <Button
                  size="sm"
                  onClick={installPWA}
                >
                  安装
                </Button>
              </div>
            </div>
          </GlassContainer>
        </motion.div>
      </AnimatePresence>
    );
  };

  4.3 性能优化和缓存策略 (1天)

  Day 19: 性能优化
  // src/utils/performance.ts
  export const lazyWithPreload = <T extends ComponentType<any>>(
    factory: () => Promise<{ default: T }>
  ) => {
    const LazyComponent = lazy(factory);
    LazyComponent.preload = factory;
    return LazyComponent;
  };

  // 预加载关键组件
  export const Dashboard = lazyWithPreload(() => import('@/features/dashboard/Dashboard'));
  export const TaskList = lazyWithPreload(() => import('@/features/tasks/TaskList'));

  // src/hooks/useIntersectionObserver.ts
  export const useIntersectionObserver = (
    callback: IntersectionObserverCallback,
    options?: IntersectionObserverInit
  ) => {
    const targetRef = useRef<HTMLElement>(null);

    useEffect(() => {
      const target = targetRef.current;
      if (!target) return;

      const observer = new IntersectionObserver(callback, options);
      observer.observe(target);

      return () => observer.disconnect();
    }, [callback, options]);

    return targetRef;
  };

  // src/components/common/LazyImage.tsx
  export const LazyImage: React.FC<LazyImageProps> = ({ src, alt, ...props }) => {
    const [isLoaded, setIsLoaded] = useState(false);
    const [isInView, setIsInView] = useState(false);

    const imageRef = useIntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsInView(true);
        }
      },
      { threshold: 0.1 }
    );

    return (
      <div ref={imageRef} className="relative overflow-hidden">
        {isInView && (
          <img
            src={src}
            alt={alt}
            onLoad={() => setIsLoaded(true)}
            className={cn(
              'transition-opacity duration-300',
              isLoaded ? 'opacity-100' : 'opacity-0',
              props.className
            )}
            {...props}
          />
        )}
        {!isLoaded && (
          <div className="absolute inset-0 bg-white/10 animate-pulse" />
        )}
      </div>
    );
  };

  ---
  📅 Phase 5: 测试和优化 (3-4天)

  5.1 测试覆盖 (2天)

  Day 20-21: 全面测试实施
  // src/components/__tests__/TaskCard.test.tsx
  import { render, screen, fireEvent, waitFor } from '@testing-library/react';
  import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
  import { TaskCard } from '../tasks/TaskCard';

  const createWrapper = () => {
    const queryClient = new QueryClient({
      defaultOptions: { queries: { retry: false } }
    });

    return ({ children }: { children: React.ReactNode }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );
  };

  describe('TaskCard', () => {
    const mockTask = {
      id: '1',
      title: '测试任务',
      description: '这是一个测试任务',
      status: 'pending',
      points: 10,
      dueDate: new Date('2024-12-31')
    };

    it('应该渲染任务信息', () => {
      render(<TaskCard task={mockTask} onUpdate={jest.fn()} />, {
        wrapper: createWrapper()
      });

      expect(screen.getByText('测试任务')).toBeInTheDocument();
      expect(screen.getByText('这是一个测试任务')).toBeInTheDocument();
      expect(screen.getByText('积分: 10')).toBeInTheDocument();
    });

    it('应该处理任务完成', async () => {
      const mockOnUpdate = jest.fn();
      render(<TaskCard task={mockTask} onUpdate={mockOnUpdate} />, {
        wrapper: createWrapper()
      });

      const completeButton = screen.getByText('完成');
      fireEvent.click(completeButton);

      await waitFor(() => {
        expect(mockOnUpdate).toHaveBeenCalledWith({
          ...mockTask,
          status: 'completed',
          completedAt: expect.any(Date)
        });
      });
    });
  });

  // src/hooks/__tests__/useAuth.test.ts
  import { renderHook, act } from '@testing-library/react';
  import { useAuth } from '../useAuth';

  // Mock API
  jest.mock('@/services/api', () => ({
    post: jest.fn(),
    get: jest.fn()
  }));

  describe('useAuth', () => {
    beforeEach(() => {
      localStorage.clear();
      jest.clearAllMocks();
    });

    it('应该处理用户登录', async () => {
      const mockUser = { id: '1', name: '测试用户', email: 'test@example.com' };
      (api.post as jest.Mock).mockResolvedValue({
        data: { token: 'test-token', user: mockUser }
      });

      const { result } = renderHook(() => useAuth());

      await act(async () => {
        await result.current.login({ username: 'test', password: 'password' });
      });

      expect(result.current.user).toEqual(mockUser);
      expect(localStorage.getItem('token')).toBe('test-token');
    });
  });

  // tests/e2e/task-management.spec.ts
  import { test, expect } from '@playwright/test';

  test.describe('任务管理功能', () => {
    test.beforeEach(async ({ page }) => {
      // 登录
      await page.goto('/login');
      await page.fill('[placeholder="用户名"]', 'testuser');
      await page.fill('[placeholder="密码"]', 'password');
      await page.click('button[type="submit"]');
      await page.waitForURL('/dashboard');
    });

    test('应该能创建新任务', async ({ page }) => {
      await page.click('text=创建任务');
      await page.waitForURL('/tasks/create');

      await page.fill('[placeholder="输入任务标题"]', '测试任务');
      await page.fill('[placeholder="详细描述任务内容"]', '这是一个测试任务描述');
      await page.fill('input[type="number"]', '15');

      await page.click('button[type="submit"]');
      await page.waitForURL('/tasks');

      await expect(page.locator('text=测试任务')).toBeVisible();
    });

    test('应该能完成任务', async ({ page }) => {
      await page.goto('/tasks');

      // 查找第一个待完成任务
      const firstTask = page.locator('[data-testid="task-card"]').first();
      await expect(firstTask).toBeVisible();

      // 点击完成按钮
      await firstTask.locator('button:has-text("完成")').click();

      // 验证任务状态更新
      await expect(firstTask.locator('text=已完成')).toBeVisible();
    });

    test('PWA安装提示应该显示', async ({ page }) => {
      // 模拟PWA安装提示
      await page.addInitScript(() => {
        window.addEventListener('beforeinstallprompt', (e) => {
          // 触发安装提示显示
        });
      });

      await page.goto('/dashboard');

      // 等待安装提示显示
      await expect(page.locator('text=安装应用')).toBeVisible({ timeout: 15000 });
    });
  });

  5.2 性能优化和部署准备 (1-2天)

  Day 22-23: 最终优化
  # 性能分析脚本
  #!/bin/bash
  # scripts/analyze-bundle.sh

  echo "🔍 分析包大小..."
  npm run build
  npm run analyze

  echo "🧪 运行性能测试..."
  npm run test:e2e -- --project=performance

  echo "📊 生成性能报告..."
  npx lighthouse http://localhost:4173 --output=html --output-path=./reports/lighthouse.html

  echo "✅ 性能分析完成，查看 ./reports/ 目录"

  // src/utils/monitoring.ts
  export const performanceMonitor = {
    measurePageLoad: () => {
      if ('performance' in window) {
        const navigation = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;
        const metrics = {
          ttfb: navigation.responseStart - navigation.requestStart,
          fcp: performance.getEntriesByName('first-contentful-paint')[0]?.startTime || 0,
          lcp: 0, // 需要通过 PerformanceObserver 获取
          cls: 0, // 需要通过 PerformanceObserver 获取
          fid: 0  // 需要通过 PerformanceObserver 获取
        };

        console.table(metrics);
        return metrics;
      }
    },

    measureComponentRender: (componentName: string) => {
      return {
        start: () => performance.mark(`${componentName}-start`),
        end: () => {
          performance.mark(`${componentName}-end`);
          performance.measure(componentName, `${componentName}-start`, `${componentName}-end`);
          const measure = performance.getEntriesByName(componentName)[0];
          console.log(`${componentName} 渲染时间: ${measure.duration.toFixed(2)}ms`);
        }
      };
    }
  };

  // 生产环境部署配置
  // docker-compose.prod.yml
  version: '3.8'
  services:
    app:
      build:
        context: .
        dockerfile: Dockerfile.prod
      ports:
        - "3000:3000"
      environment:
        - NODE_ENV=production
        - API_URL=https://api.kdfamily.com
      volumes:
        - ./uploads:/app/uploads

    nginx:
      image: nginx:alpine
      ports:
        - "80:80"
        - "443:443"
      volumes:
        - ./nginx.conf:/etc/nginx/nginx.conf
        - ./ssl:/etc/nginx/ssl
      depends_on:
        - app